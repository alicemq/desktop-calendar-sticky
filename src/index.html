<!DOCTYPE html>
<html>
    <head>
        <title>Wall Calendar Widget</title>
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <meta charset="UTF-8">
        <script type="text/javascript">

        function enableDragging() {
            var offsetX, offsetY, isDragging = false;

            document.onmousedown = function (e) {
                isDragging = true;
                offsetX = e.clientX - document.body.getBoundingClientRect().left;
                offsetY = e.clientY - document.body.getBoundingClientRect().top;
                return false;
            };

            document.onmousemove = function (e) {
                if (isDragging) {
                    window.moveTo(e.screenX - offsetX, e.screenY - offsetY);
                }
            };

            document.onmouseup = function () {
                isDragging = false;
            };
        }

        function init() {
            window.resizeTo(300, 200); // Set default size
            window.moveTo(100, 100);   // Set initial position
            enableDragging();
            setInterval(makeAlwaysOnTop, 2000); // Keep it on top
        }

        window.onload = init;
    </script>
        
        <link rel="stylesheet" href="styles.css">
    </head>
    <body data-tauri-drag-region>
        <div class="drag-overlay" data-tauri-drag-region></div>
        <div class="calendar" id="current-month-calendar"></div>
        <div class="calendar" id="second-month-calendar"></div>
        <div class="calendar" id="third-month-calendar"></div>

        <script type="text/javascript">
            function adjustTooltipPositions() {
    document.querySelectorAll('.tooltip-container').forEach(el => {
        let rect = el.getBoundingClientRect();
        let tooltipWidth = 150; // Max tooltip width
        let margin = 10; // Safety margin from edges

        // Remove previous classes
        el.classList.remove("tooltip-bottom", "tooltip-left", "tooltip-right");

        // If too close to the top, move tooltip below
        if (rect.top < 50) {
            el.classList.add("tooltip-bottom");
        }

        // If too close to the right edge, shift left
        if (rect.left + tooltipWidth > window.innerWidth - margin) {
            el.classList.add("tooltip-left");
        }

        // If too close to the left edge, shift right
        if (rect.left < margin) {
            el.classList.add("tooltip-right");
        }
    });
}

// Run function after calendar is generated
setTimeout(adjustTooltipPositions, 100);
window.addEventListener("resize", adjustTooltipPositions);

        function getEasterDate(year) {
            var a = year % 19;
            var b = Math.floor(year / 100);
            var c = year % 100;
            var d = Math.floor(b / 4);
            var e = b % 4;
            var f = Math.floor((b + 8) / 25);
            var g = Math.floor((b - f + 1) / 3);
            var h = (19 * a + b - d - g + 15) % 30;
            var i = Math.floor(c / 4);
            var k = c % 4;
            var l = (32 + 2 * e + 2 * i - h - k) % 7;
            var m = Math.floor((a + 11 * h + 22 * l) / 451);
            var month = Math.floor((h + l - 7 * m + 114) / 31);
            var day = ((h + l - 7 * m + 114) % 31) + 1;
            return { month: month - 1, day: day }; // month is 0-indexed
        }

        function generateCalendar(year, month, elementId) {
            var daysInMonth = new Date(year, month + 1, 0).getDate();
            var firstDay = new Date(year, month, 1).getDay();
            firstDay = (firstDay === 0) ? 6 : firstDay - 1; // Adjust to make Monday the first day
            var lastDayPrevMonth = new Date(year, month, 0).getDate();
            var today = new Date();

            // Lithuanian holidays (month is 0-indexed, i.e., January is 0)
            var easter = getEasterDate(year);
            var holidays = [
                { month: 0, day: 1, name: "Naujųjų metų diena" },
                { month: 1, day: 16, name: "Lietuvos valstybės atkūrimo diena" },
                { month: 2, day: 11, name: "Lietuvos nepriklausomybės atkūrimo diena" },
                { month: easter.month, day: easter.day, name: "Velykų sekmadienis" },
                { month: easter.month, day: easter.day + 1, name: "Velykų pirmadienis" },
                { month: 4, day: 1, name: "Tarptautinė darbo diena" },
                { month: 5, day: 24, name: "Rasos ir Joninių diena" },
                { month: 6, day: 6, name: "Valstybės diena" },
                { month: 7, day: 15, name: "Žolinė" },
                { month: 10, day: 1, name: "Visų Šventųjų diena" },
                { month: 10, day: 2, name: "Vėlinės" },
                { month: 11, day: 24, name: "Kūčios" },
                { month: 11, day: 25, name: "Kalėdos" },
                { month: 11, day: 26, name: "Antroji Kalėdų diena" }
            ];

            var calendarHtml = '<div class="calendar-header">' + new Date(year, month, 1).toLocaleString('lt-LT', { month: 'long', year: 'numeric' }) + '</div>';
            calendarHtml += '<div class="calendar-grid">';

            // Weekday abbreviations
            calendarHtml += '<div class="week-number"></div>';
            calendarHtml += '<div class="weekday">Mo</div>';
            calendarHtml += '<div class="weekday">Tu</div>';
            calendarHtml += '<div class="weekday">We</div>';
            calendarHtml += '<div class="weekday">Th</div>';
            calendarHtml += '<div class="weekday">Fr</div>';
            calendarHtml += '<div class="weekday">Sa</div>';
            calendarHtml += '<div class="weekday">Su</div>';

            // Week number display
            var weekNumber = getWeekNumber(new Date(year, month, 1));
            calendarHtml += '<div class="week-number">W' + weekNumber + '</div>';

            // Previous month days
            for (var i = firstDay; i > 0; i--) {
                calendarHtml += '<div class="calendar-day other-month">' + (lastDayPrevMonth - i + 1) + '</div>';
            }

            // Current month days
            for (var day = 1; day <= daysInMonth; day++) {
                var currentDate = new Date(year, month, day);
                 var isToday = (currentDate.getFullYear() === today.getFullYear() &&
                       currentDate.getMonth() === today.getMonth() &&
                       currentDate.getDate() === today.getDate());
                var isWeekend = (currentDate.getDay() === 6 || currentDate.getDay() === 0); // Saturday (6) or Sunday (0)
                var holiday = holidays.find(holiday => holiday.month === month && holiday.day === day);
                var isHoliday = holiday;
                var dayClass = "calendar-day";
                if (isToday) dayClass += " today";
                if (isHoliday) dayClass += " holiday";
                if (isWeekend) dayClass += " weekend";
                else dayClass += " workday";
                
                // Insert week number before Mondays
                if (currentDate.getDay() === 1 && day != 1) {
                    weekNumber = getWeekNumber(currentDate);
                    calendarHtml += '<div class="week-number">W' + weekNumber + '</div>';
                }

          // Apply tooltip if it's a holiday
                var tooltipAttr = isHoliday ? ' data-tooltip="' + holiday.name + '" data-tauri-drag-region' : "";
                if (isHoliday) dayClass +=" tooltip-container"
                calendarHtml += '<div class="' + dayClass + '"' + tooltipAttr + '>' + day + '</div>';
            }

            // Next month days to fill the grid
            var nextMonthDay = 1;
            while ((firstDay + daysInMonth + nextMonthDay - 1) % 7 !== 0 || nextMonthDay === 1) {
                calendarHtml += '<div class="calendar-day other-month">' + nextMonthDay + '</div>';
                nextMonthDay++;
            }

            calendarHtml += '</div>';
            document.getElementById(elementId).innerHTML = calendarHtml;
        }

        function getWeekNumber(date) {
            var firstDay = new Date(date.getFullYear(), 0, 1).getDay();
            var days = Math.floor((date - new Date(date.getFullYear(), 0, 1)) / 86400000);
            return Math.ceil((days + firstDay) / 7);
        }

        function updateCalendars() {
            var now = new Date();
            generateCalendar(now.getFullYear(), now.getMonth(), 'current-month-calendar');
            generateCalendar(now.getFullYear(), now.getMonth() + 1, 'second-month-calendar');
            generateCalendar(now.getFullYear(), now.getMonth() + 2, 'third-month-calendar');
        }

        updateCalendars();
        setInterval(updateCalendars, 1000 * 60 * 60 * 24); // Update every day
    </script>
    </body>
</html>
